<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kerttervez≈ë</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.js"></script>
    <link rel="icon" type="image/x-icon" href="\novenyek/favicon.png">


    <style>

        table {
            width: 60%;
            margin: auto;
            margin-bottom: 100px;
            border-collapse: collapse;
 

        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;

        }
        img {
            width: 20px;
            height: 20px;
        }

        #hozzaadasa{
            width: 70%;
            margin: auto;
            margin-top: 100px;
            margin-bottom: 50px;

            text-align: center;
            vertical-align: middle;
            justify-content: center;
            align-items: center;

            background-color:#85A947;
            border: #3E7B27 15px solid;
            padding: 30px;
            box-shadow: 10px 10px 26px -1px rgba(0,0,0,0.55);
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.2), 0 4px 8px rgba(0, 0, 0, 0.3);
            border-radius: 10px;

        }
        input[type=number]{
            width: 130px;
        }
        input[type=color]{
            width: 100px;
            height: 40px;
        }

    </style>


</head>
<body>
    <div id="top" class="">

        <h5 id="tervezes" onclick="location.reload()"> <a href="index.html" style="text-decoration: none;     color: rgb(243, 233, 233);">Tervez√©s</a></h5>
        <h5 id="hozzaadas"> <a href="hozzaadas.html" style="text-decoration: none;     color: rgb(243, 233, 233);">Hozz√°ad√°s</a></h5>

        <h3 id="oldalnev">Kerttervez≈ë</h3>


    </div>



    <div id="hozzaadasa">
        <h2>√öj n√∂v√©ny hozz√°ad√°sa</h2>
        <form id="novenyForm">
        <label>Magyar n√©v: <input type="text" id="magyarNev" required></label><br>
        <label>Latin n√©v: <input type="text" id="latinNev"></label><br>
        <label>Sor t√°vols√°g (cm): <input type="number" id="sorTav" min="1" required></label><br>
        <label>T≈ë t√°vols√°g (cm): <input type="number" id="toTav"min="1" required></label><br>

        <label>Sz√≠n v√°laszt√°s: <input type="color" id="novenySzin" name="color" required></label><br>

        
        <button type="submit" id="hozza">Hozz√°ad√°s</button>
    </form>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>K√©p</th>
                <th>Magyar n√©v</th>
                <th>Latin n√©v</th>
                <th>Sor t√°vols√°g</th>
                <th>T≈ë t√°vols√°g</th>
                <th>T√∂rl√©s</th>

            </tr>
        </thead>
        <tbody id="novenyekTable"></tbody>
    </table>

   <!--Ha a n√∂veny[i].kep nem tartalmaz '.png'-t, vagyis egy sz√≠nk√≥d, akkor a sz√≠nk√≥d legyen a k√©pe


    <input type="text" id="kepUrl">-->

    <script>
       class Noveny {
    constructor(id, magyar, latin, sor_tav, to_tav, kep, szin) {
        this.id = id;
        this.magyar = magyar;
        this.latin = latin;
        this.sor_tav = sor_tav;
        this.to_tav = to_tav;
        this.kep = kep || null;
        this.szin = szin || "#cccccc";  // Alap√©rtelmezett sz√≠n, ha nincs megadva
    }

            renderRow(index) {
            let imgContent = (this.kep && this.kep.includes('.png')) 
                ? `<img src="${this.kep}" alt="${this.magyar}" onerror="this.onerror=null; this.src='fallback.png';" style="width:50px; height:50px;">`
                : `<div style="width: 50px; height: 50px; background-color: ${this.kep || '#cccccc'};"></div>`;

            return `
                <tr>
                    <td>${imgContent}</td>
                    <td>${this.magyar}</td>
                    <td>${this.latin}</td>
                    <td>${this.sor_tav} cm</td>
                    <td>${this.to_tav} cm</td>
                    <td><button onclick="torolNoveny(${index})">üóëÔ∏è</button></td>
                </tr>
            `;
        }
       }

           /* renderRow(index) { //ezzel m≈±k√∂dik, csak a sz√≠nk√≥dot nem √©rti

                return `
                    <tr>
                        <td><img src="${this.kep}" alt="${this.magyar}"></td>
                        <td>${this.magyar}</td>
                        <td>${this.latin}</td>
                        <td>${this.sor_tav} cm</td>
                        <td>${this.to_tav} cm</td>
                        <td><button onclick="torolNoveny(${index})">üóëÔ∏è</button></td>
                    </tr>
                `;
            }
            renderRow(index) {
                let imgContent = this.kep && this.kep.trim() !== ""
        ? `<img src="${this.kep}" alt="${this.magyar}" onerror="this.onerror=null; this.src='fallback.png';">`
        : `<div style="width: 50px; height: 50px; background-color: ${this.szin || 'gray'};"></div>`;


                return `
                    <tr>
                        <td>${imgContent}</td>
                        <td>${this.magyar}</td>
                        <td>${this.latin}</td>
                        <td>${this.sor_tav} cm</td>
                        <td>${this.to_tav} cm</td>
                        <td><button onclick="torolNoveny(${index})">üóëÔ∏è</button></td>
                    </tr>
                `;
            }
        }*/

        let db;
        let novenyekLista = [];

        async function loadDatabase() {
            const SQL = await initSqlJs({ locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/${file}` });

            const response = await fetch("kerttervezo.db");
            const buffer = await response.arrayBuffer();
            db = new SQL.Database(new Uint8Array(buffer));

            loadTable();
        }

        function loadTable() {
            const results = db.exec("SELECT magyar_nev, latin_nev, sor_tav, to_tav, kep, szin FROM novenyek");
            let adatbazisNovenyek = results[0].values.map(row => 
                new Noveny(Date.now(), row[0], row[1], row[2], row[3], row[4], row[5] || "#cccccc")
            );

            const localData = JSON.parse(localStorage.getItem("novenyek")) || [];

            const uniqueNovenyek = [...adatbazisNovenyek];

            localData.forEach(localNoveny => {
                let alreadyExists = uniqueNovenyek.some(n => n.magyar === localNoveny.magyar);
                if (!alreadyExists) {
                    uniqueNovenyek.push(new Noveny(localNoveny.id, localNoveny.magyar, localNoveny.latin, localNoveny.sor_tav, localNoveny.to_tav, localNoveny.kep, localNoveny.szin));
                }
            });

            novenyekLista = uniqueNovenyek;
            renderTable();
        }


        function renderTable() {
            let table = document.getElementById("novenyekTable");
            table.innerHTML = novenyekLista.map((noveny, index) => noveny.renderRow(index)).join("");
        }


                document.getElementById("novenyForm").addEventListener("submit", function(event) {
            event.preventDefault();

            let magyarNev = document.getElementById("magyarNev").value;
            let latinNev = document.getElementById("latinNev").value;
            let sorTav = document.getElementById("sorTav").value;
            let toTav = document.getElementById("toTav").value;

            let szin = document.getElementById("novenySzin").value.trim();

            // Ha nincs k√©p megadva, akkor a sz√≠n legyen az √©rt√©k
            let finalKep = kep ? kep : szin;

            let ujNoveny = new Noveny(Date.now(), magyarNev, latinNev, sorTav, toTav, finalKep, szin);
            novenyekLista.push(ujNoveny);

            // Ment√©s localStorage-ba
            localStorage.setItem("novenyek", JSON.stringify(novenyekLista));

            renderTable();
});

       /* function torolNoveny(index) {
            if (confirm("Biztosan t√∂rl√∂d ezt a n√∂v√©nyt?")) {
                
                novenyekLista.splice(index, 1);

               
                localStorage.setItem("novenyek", JSON.stringify(novenyekLista));

                
                renderTable();
            }
        }*/
                    function torolNoveny(index) {
                if (confirm("Biztosan t√∂rl√∂d ezt a n√∂v√©nyt?")) {
                    novenyekLista.splice(index, 1);
                    localStorage.setItem("novenyek", JSON.stringify(novenyekLista));
                    renderTable();
                }
            }

            
        loadDatabase();
    </script>




    <div id="footer">
        <p>¬© 2025</p>
    </div>


</body>
</html>